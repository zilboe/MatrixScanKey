C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\Key.obj
COMPILER INVOKED BY: D:\Keil5_Mdk\C51\BIN\C51.EXE Key\Key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\key_scan;.\Key;.\usart;.\
                    -Timer;.\Application;.\DS18B20) DEBUG OBJECTEXTEND PRINT(.\Listings\Key.lst) TABS(2) OBJECT(.\Objects\Key.obj)

line level    source

   1          #include "Key.h"
   2          #include "ds18b20.h"
   3          Key_Info_t Key_Board;
   4          extern uint32_t systicks;
   5          extern uint32_t keyComNumber;
   6          uint8_t key_row[4] = {0x7f, 0xbf, 0xdf, 0xef};
   7          /**
   8           * @brief æŒ‰é”®ä¿¡æ¯çš„åˆå§‹åŒ–
   9           * @param Key å­˜å‚¨æŒ‰é”®çš„ç»“æž„ä½“
  10           *
  11           */
  12          void ScanKeyInit(Key_Info_t *Key)
  13          {
  14   1        Key->key_Number = 0;
  15   1        Key->key_Action_Flag = false;
  16   1        Key->key_func = keyFuncProcess;
  17   1        Key->key_Last_value = 0x00;
  18   1        Key->key_value[0] = 0x00;
  19   1        Key->key_value[1] = 0x00;
  20   1        Key->key_status = Key_None;
  21   1        Key->Key_Long_Count = 0;
  22   1        Key->key_long_scan_Count = 0;
  23   1      }
  24          
  25          bool KeyIsDown(uint8_t keyvalue)
  26          {
  27   1        if (keyvalue != 0x00)
  28   1        {
  29   2          return true;
  30   2        }
  31   1        else
  32   1        {
  33   2          return false;
  34   2        }
  35   1      }
  36          /**
  37           * @brief æ£€æŸ¥æŒ‰é”®æ˜¯å¦åˆšæŒ‰ä¸‹
  38           * @param keyvalue é”®å€¼
  39           * @return true åˆšæŒ‰ä¸‹ false ä¸æ˜¯
  40           *
  41           */
  42          bool KeyIsClick(uint8_t keyvalue)
  43          {
  44   1        if (KeyIsDown(keyvalue))
  45   1        {
  46   2          if (Key_Board.key_value[0] == 0X00) /*ä¸èƒ½åˆ¤æ–­lastå€¼ï¼Œå¿…é¡»åˆ¤æ–­æ”¶å½•çš„å€¼*/
  47   2            return true;
  48   2          else
  49   2            return false;
  50   2        }
  51   1        else
  52   1          return false;
  53   1      }
  54          
C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 2   

  55          /**
  56           * @brief æ£€æŸ¥æŒ‰é”®æ˜¯å¦è¢«æŠ¬èµ·
  57           * @param keyvalue é”®å€¼
  58           * @return true æ˜¯ false ä¸æ˜¯
  59           */
  60          bool KeyIsUp(uint8_t keyvalue)
  61          {
  62   1        if (KeyIsDown(keyvalue))
  63   1          return false;
  64   1        else
  65   1        {
  66   2          if (Key_Board.key_Last_value != 0x00)
  67   2            return true;
  68   2          else
  69   2            return false;
  70   2        }
  71   1      }
  72          
  73          void KeyValueProcess(uint8_t key, Key_Info_t *keyboard)
  74          {
  75   1        if (key != 0x00)
  76   1        {
  77   2          if (KeyIsClick(key))
  78   2          {
  79   3            /* åˆšæŒ‰ä¸‹çš„çŠ¶æ€ */
  80   3            keyboard->key_value[keyboard->key_Number++] = key;
  81   3            keyboard->key_Last_value = 0x00;
  82   3            keyboard->key_Action_Flag = true;
  83   3            keyboard->key_status = Key_Short_Press;
  84   3            keyboard->Key_Long_Count = systicks;
  85   3          }
  86   2          else if (KeyIsDown(key) && keyboard->key_value[0] == key && keyboard->key_Number == 1)
  87   2          {
  88   3            /* å¤„ç†é•¿æŒ‰ */
  89   3            if (systicks - keyboard->Key_Long_Count > 1000) /* 2s */
  90   3            {
  91   4              keyboard->key_Last_value = keyboard->key_value[0];
  92   4              keyboard->key_status = Key_Long_Press;
  93   4              keyboard->key_Action_Flag = true;
  94   4            }
  95   3            else
  96   3            {
  97   4              keyboard->key_Last_value = keyboard->key_value[0];
  98   4              keyboard->key_Action_Flag = false;
  99   4            }
 100   3          }
 101   2          else if (KeyIsDown(key) && keyboard->key_value[0] != key && keyboard->key_Number == 1)
 102   2          {
 103   3            /* å¤åˆæŒ‰é”® */
 104   3            keyboard->key_Last_value = keyboard->key_value[0];
 105   3            keyboard->key_value[1] = key;
 106   3            keyboard->key_Action_Flag = true;
 107   3            keyboard->key_status = Key_Compound_Press;
 108   3            keyboard->key_Number = 2;
 109   3          }
 110   2          /* æŒ‰ä¸‹çŠ¶æ€ + æŒ‰é”®ä¸Žä¹‹å‰ä¸¤ä¸ªæŒ‰é”®æŸä¸€ä¸ªç›¸åŒ + æŒ‰é”®è®°å½•æ•°å·²ç»åˆ°2 */
 111   2          else if(KeyIsDown(key)  && keyboard->key_Number == 2 && (key==keyboard->key_value[0] || key==keyboard->k
             -ey_value[1]))
 112   2          {
 113   3            if (keyComNumber>10) /* é•¿æ—¶é—´æ£€æµ‹åˆ°åªæœ‰ä¸€ä¸ªæŒ‰é”®ï¼Œç¡®ä¿å¦ä¸€ä¸ªæŒ‰é”®å·²è¢«æŠ¬èµ·ï¼Œå…ˆå
             -¤„ç†æŠ¬èµ·çš„æŒ‰é”® */
 114   3            {
C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 3   

 115   4              if(key == keyboard->key_value[0]) /* ç¬¬ä¸€ä¸ªæŒ‰é”®æ²¡æ¾æ‰‹ */
 116   4              {
 117   5                keyboard->key_value[1] = 0x00;
 118   5                keyboard->key_Number = 1;
 119   5                keyboard->key_status = Key_Lift;
 120   5                keyboard->key_Action_Flag = true;
 121   5              }
 122   4              else if(key == keyboard->key_value[1])  /* ç¬¬äºŒä¸ªæŒ‰é”®æ²¡æ¾æ‰‹ */
 123   4              {
 124   5                keyboard->key_value[0] = 0x00;
 125   5                keyboard->key_Number = 1;
 126   5                keyboard->key_status = Key_Lift;
 127   5                keyboard->key_Action_Flag = true;
 128   5              }
 129   4              else
 130   4              {
 131   5                return;
 132   5              }
 133   4            }
 134   3          }
 135   2        }
 136   1        else if (KeyIsUp(key))
 137   1        {
 138   2          /* æŒ‰é”®æŠ¬èµ· */
 139   2          keyboard->key_Last_value = key;
 140   2          keyboard->key_status = Key_Lift;
 141   2          keyboard->key_value[keyboard->key_Number--] = 0x00;
 142   2          keyboard->key_Action_Flag = true;
 143   2        }
 144   1        else
 145   1        {
 146   2          /* none */
 147   2          keyboard->key_Action_Flag = false;
 148   2          keyboard->key_value[0] = 0x00;
 149   2          keyboard->key_value[1] = 0x00;
 150   2          keyboard->key_status = Key_None;
 151   2          keyboard->key_Last_value = 0x00;
 152   2        }
 153   1      }
 154          
 155          void keyFuncProcess(Key_Info_t *key)
 156          {
 157   1        if (key->key_Action_Flag == false)
 158   1          return;
 159   1        if (key->key_status == Key_Short_Press)
 160   1        {
 161   2          KeyShortAction(key);
 162   2        }
 163   1        else if (key->key_status == Key_Long_Press)
 164   1        {
 165   2          if ((systicks - key->key_long_scan_Count) > 1000)
 166   2          {
 167   3            key->key_long_press_action_flag = true;
 168   3          }
 169   2          if (key->key_long_press_action_flag == true) /* é•¿æŒ‰ä¸æ¾æ‰‹,æ¯2sæ‰§è¡Œä¸€æ¬¡ç¨‹åº */
 170   2          {
 171   3            KeyLongAction(key);
 172   3            key->key_long_press_action_flag = false;
 173   3            key->key_long_scan_Count = systicks;
 174   3          }
 175   2        }
 176   1        else if (key->key_status == Key_Lift)
C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 4   

 177   1        {
 178   2          KeyLiftAction(key);
 179   2        }
 180   1        else if (key->key_status == Key_Compound_Press)
 181   1        {
 182   2          KeyCompoundAction(key);
 183   2        }
 184   1      }
 185          
 186          void KeyShortAction(Key_Info_t *key)
 187          {
 188   1        if (key->key_status != Key_Short_Press)
 189   1          return;
 190   1        switch (key->key_value[0])
 191   1        {
 192   2        case S1:
 193   2          //sendString("S1 is down\r\n");
 194   2          sendByte(TempValue);
 195   2          break;
 196   2        case S2:
 197   2          sendString("S2 is down\r\n");
 198   2          break;
 199   2        case S3:
 200   2          sendString("S3 is down\r\n");
 201   2          break;
 202   2        case S4:
 203   2          sendString("S4 is down\r\n");
 204   2          break;
 205   2        case S5:
 206   2          sendString("S5 is down\r\n");
 207   2          break;
 208   2        case S6:
 209   2          sendString("S6 is down\r\n");
 210   2          break;
 211   2        case S7:
 212   2          sendString("S7 is down\r\n");
 213   2          break;
 214   2        case S8:
 215   2          sendString("S8 is down\r\n");
 216   2          break;
 217   2        case S9:
 218   2          sendString("S9 is down\r\n");
 219   2          break;
 220   2        case S10:
 221   2          sendString("S10 is down\r\n");
 222   2          break;
 223   2        case S11:
 224   2          sendString("S11 is down\r\n");
 225   2          break;
 226   2        case S12:
 227   2          sendString("S12 is down\r\n");
 228   2          break;
 229   2        case S13:
 230   2          sendString("S13 is down\r\n");
 231   2          break;
 232   2        case S14:
 233   2          sendString("S14 is down\r\n");
 234   2          break;
 235   2        case S15:
 236   2          sendString("S15 is down\r\n");
 237   2          break;
 238   2        case S16:
C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 5   

 239   2          sendString("S16 is down\r\n");
 240   2          break;
 241   2        }
 242   1        key->key_status = Key_None;
 243   1      }
 244          
 245          void KeyLongAction(Key_Info_t *key)
 246          {
 247   1        if (key->key_status != Key_Long_Press)
 248   1          return;
 249   1        switch (key->key_value[0])
 250   1        {
 251   2        case S1:
 252   2          sendString("S1 is LongPress\r\n");
 253   2          break;
 254   2        case S2:
 255   2          sendString("S2 is LongPress\r\n");
 256   2          break;
 257   2        case S3:
 258   2          sendString("S3 is LongPress\r\n");
 259   2          break;
 260   2        case S4:
 261   2          sendString("S4 is LongPress\r\n");
 262   2          break;
 263   2        case S5:
 264   2          sendString("S5 is LongPress\r\n");
 265   2          break;
 266   2        case S6:
 267   2          sendString("S6 is LongPress\r\n");
 268   2          break;
 269   2        case S7:
 270   2          sendString("S7 is LongPress\r\n");
 271   2          break;
 272   2        case S8:
 273   2          sendString("S8 is LongPress\r\n");
 274   2          break;
 275   2        case S9:
 276   2          sendString("S9 is LongPress\r\n");
 277   2          break;
 278   2        case S10:
 279   2          sendString("S10 is LongPress\r\n");
 280   2          break;
 281   2        case S11:
 282   2          sendString("S11 is LongPress\r\n");
 283   2          break;
 284   2        case S12:
 285   2          sendString("S12 is LongPress\r\n");
 286   2          break;
 287   2        case S13:
 288   2          sendString("S13 is LongPress\r\n");
 289   2          break;
 290   2        case S14:
 291   2          sendString("S14 is LongPress\r\n");
 292   2          break;
 293   2        case S15:
 294   2          sendString("S15 is LongPress\r\n");
 295   2          break;
 296   2        case S16:
 297   2          sendString("S16 is LongPress\r\n");
 298   2          break;
 299   2        }
 300   1        key->key_status = Key_None;
C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 6   

 301   1      }
 302          
 303          void KeyLiftAction(Key_Info_t *key)
 304          {
 305   1        uint8_t keyvalue = 0x00;
 306   1        if (key->key_status != Key_Lift)
 307   1          return;
 308   1        if (key->key_value[1] == 0x00 && key->key_value[0] != 0x00)
 309   1          keyvalue = key->key_value[0];
 310   1        else if (key->key_value[1] != 0x00)
 311   1          keyvalue = key->key_value[1];
 312   1        switch (keyvalue)
 313   1        {
 314   2        case S1:
 315   2          //sendString("S1 is Lift\r\n");
 316   2          break;
 317   2        case S2:
 318   2          sendString("S2 is Lift\r\n");
 319   2          break;
 320   2        case S3:
 321   2          sendString("S3 is Lift\r\n");
 322   2          break;
 323   2        case S4:
 324   2          sendString("S4 is Lift\r\n");
 325   2          break;
 326   2        case S5:
 327   2          sendString("S5 is Lift\r\n");
 328   2          break;
 329   2        case S6:
 330   2          sendString("S6 is Lift\r\n");
 331   2          break;
 332   2        case S7:
 333   2          sendString("S7 is Lift\r\n");
 334   2          break;
 335   2        case S8:
 336   2          sendString("S8 is Lift\r\n");
 337   2          break;
 338   2        case S9:
 339   2          sendString("S9 is Lift\r\n");
 340   2          break;
 341   2        case S10:
 342   2          sendString("S10 is Lift\r\n");
 343   2          break;
 344   2        case S11:
 345   2          sendString("S11 is Lift\r\n");
 346   2          break;
 347   2        case S12:
 348   2          sendString("S12 is Lift\r\n");
 349   2          break;
 350   2        case S13:
 351   2          sendString("S13 is Lift\r\n");
 352   2          break;
 353   2        case S14:
 354   2          sendString("S14 is Lift\r\n");
 355   2          break;
 356   2        case S15:
 357   2          sendString("S15 is Lift\r\n");
 358   2          break;
 359   2        case S16:
 360   2          sendString("S16 is Lift\r\n");
 361   2          break;
 362   2        }
C51 COMPILER V9.57.0.0   KEY                                                               06/01/2023 22:29:38 PAGE 7   

 363   1        key->key_status = Key_None;
 364   1      }
 365          
 366          void KeyCompoundAction(Key_Info_t *key)
 367          {
 368   1        if (key->key_status != Key_Compound_Press)
 369   1          return;
 370   1        if ((key->key_value[0] == S1 && key->key_value[1] == S6) || (key->key_value[1] == S1 && key->key_value[0]
             - == S6))
 371   1        {
 372   2          sendString("S1 And S2 Compound Press\r\n");
 373   2        }
 374   1        
 375   1        key->key_status = Key_None;
 376   1      }
 377          
 378          uint8_t getKeyValue(void)
 379          {
 380   1        uint8_t i = 0;
 381   1        uint8_t keyValue = 0x00;
 382   1        for (i = 0; i < 4; i++)
 383   1        {
 384   2          P1 = key_row[i];
 385   2          if ((P1 & key_row[i]) != key_row[i])
 386   2          {
 387   3            keyValue = P1;
 388   3            goto k1;
 389   3          }
 390   2        }
 391   1      k1:
 392   1        return keyValue;
 393   1      }
 394          
 395          uint8_t getKeyValue2(void)
 396          {
 397   1        char i = 0;
 398   1        uint8_t keyValue = 0x00;
 399   1        for (i = 3; i > -1; i--)
 400   1        {
 401   2          P1 = key_row[i];
 402   2          if ((P1 & key_row[i]) != key_row[i])
 403   2          {
 404   3            keyValue = P1;
 405   3            goto k2;
 406   3          }
 407   2        }
 408   1      k2:
 409   1        return keyValue;
 410   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1552    ----
   CONSTANT SIZE    =    726    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19      18
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
