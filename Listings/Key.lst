C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\Key.obj
COMPILER INVOKED BY: D:\Keil5_Mdk\C51\BIN\C51.EXE Key\Key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\key_scan;.\Key;.\usart;.\
                    -Timer;.\Application) DEBUG OBJECTEXTEND PRINT(.\Listings\Key.lst) TABS(2) OBJECT(.\Objects\Key.obj)

line level    source

   1          #include "Key.h"
   2          Key_Info_t Key_Board;
   3          extern uint32_t systicks;
   4          extern uint32_t keyComNumber;
   5          uint8_t key_row[4] = {0x7f, 0xbf, 0xdf, 0xef};
   6          /**
   7           * @brief æŒ‰é”®ä¿¡æ¯çš„åˆå§‹åŒ–
   8           * @param Key å­˜å‚¨æŒ‰é”®çš„ç»“æž„ä½“
   9           *
  10           */
  11          void ScanKeyInit(Key_Info_t *Key)
  12          {
  13   1        Key->key_Number = 0;
  14   1        Key->key_Action_Flag = false;
  15   1        Key->key_func = keyFuncProcess;
  16   1        Key->key_Last_value = 0x00;
  17   1        Key->key_value[0] = 0x00;
  18   1        Key->key_value[1] = 0x00;
  19   1        Key->key_status = Key_None;
  20   1        Key->Key_Long_Count = 0;
  21   1        Key->key_long_scan_Count = 0;
  22   1      }
  23          
  24          bool KeyIsDown(uint8_t keyvalue)
  25          {
  26   1        if (keyvalue != 0x00)
  27   1        {
  28   2          return true;
  29   2        }
  30   1        else
  31   1        {
  32   2          return false;
  33   2        }
  34   1      }
  35          /**
  36           * @brief æ£€æŸ¥æŒ‰é”®æ˜¯å¦åˆšæŒ‰ä¸‹
  37           * @param keyvalue é”®å€¼
  38           * @return true åˆšæŒ‰ä¸‹ false ä¸æ˜¯
  39           *
  40           */
  41          bool KeyIsClick(uint8_t keyvalue)
  42          {
  43   1        if (KeyIsDown(keyvalue))
  44   1        {
  45   2          if (Key_Board.key_value[0] == 0X00) /*ä¸èƒ½åˆ¤æ–­lastå€¼ï¼Œå¿…é¡»åˆ¤æ–­æ”¶å½•çš„å€¼*/
  46   2            return true;
  47   2          else
  48   2            return false;
  49   2        }
  50   1        else
  51   1          return false;
  52   1      }
  53          
  54          /**
C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 2   

  55           * @brief æ£€æŸ¥æŒ‰é”®æ˜¯å¦è¢«æŠ¬èµ·
  56           * @param keyvalue é”®å€¼
  57           * @return true æ˜¯ false ä¸æ˜¯
  58           */
  59          bool KeyIsUp(uint8_t keyvalue)
  60          {
  61   1        if (KeyIsDown(keyvalue))
  62   1          return false;
  63   1        else
  64   1        {
  65   2          if (Key_Board.key_Last_value != 0x00)
  66   2            return true;
  67   2          else
  68   2            return false;
  69   2        }
  70   1      }
  71          
  72          void KeyValueProcess(uint8_t key, Key_Info_t *keyboard)
  73          {
  74   1        if (key != 0x00)
  75   1        {
  76   2          if (KeyIsClick(key))
  77   2          {
  78   3            /* åˆšæŒ‰ä¸‹çš„çŠ¶æ€ */
  79   3            keyboard->key_value[keyboard->key_Number++] = key;
  80   3            keyboard->key_Last_value = 0x00;
  81   3            keyboard->key_Action_Flag = true;
  82   3            keyboard->key_status = Key_Short_Press;
  83   3            keyboard->Key_Long_Count = systicks;
  84   3          }
  85   2          else if (KeyIsDown(key) && keyboard->key_value[0] == key && keyboard->key_Number == 1)
  86   2          {
  87   3            /* å¤„ç†é•¿æŒ‰ */
  88   3            if (systicks - keyboard->Key_Long_Count > 1000) /* 2s */
  89   3            {
  90   4              keyboard->key_Last_value = keyboard->key_value[0];
  91   4              keyboard->key_status = Key_Long_Press;
  92   4              keyboard->key_Action_Flag = true;
  93   4            }
  94   3            else
  95   3            {
  96   4              keyboard->key_Last_value = keyboard->key_value[0];
  97   4              keyboard->key_Action_Flag = false;
  98   4            }
  99   3          }
 100   2          else if (KeyIsDown(key) && keyboard->key_value[0] != key && keyboard->key_Number == 1)
 101   2          {
 102   3            /* å¤åˆæŒ‰é”® */
 103   3            keyboard->key_Last_value = keyboard->key_value[0];
 104   3            keyboard->key_value[1] = key;
 105   3            keyboard->key_Action_Flag = true;
 106   3            keyboard->key_status = Key_Compound_Press;
 107   3            keyboard->key_Number = 2;
 108   3          }
 109   2          /* æŒ‰ä¸‹çŠ¶æ€ + æŒ‰é”®ä¸Žä¹‹å‰ä¸¤ä¸ªæŒ‰é”®æŸä¸€ä¸ªç›¸åŒ + æŒ‰é”®è®°å½•æ•°å·²ç»åˆ°2 */
 110   2          else if(KeyIsDown(key)  && keyboard->key_Number == 2 && (key==keyboard->key_value[0] || key==keyboard->k
             -ey_value[1]))
 111   2          {
 112   3            if (keyComNumber>10) /* é•¿æ—¶é—´æ£€æµ‹åˆ°åªæœ‰ä¸€ä¸ªæŒ‰é”®ï¼Œç¡®ä¿å¦ä¸€ä¸ªæŒ‰é”®å·²è¢«æŠ¬èµ·ï¼Œå…ˆå
             -¤„ç†æŠ¬èµ·çš„æŒ‰é”® */
 113   3            {
 114   4              if(key == keyboard->key_value[0]) /* ç¬¬ä¸€ä¸ªæŒ‰é”®æ²¡æ¾æ‰‹ */
C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 3   

 115   4              {
 116   5                keyboard->key_value[1] = 0x00;
 117   5                keyboard->key_Number = 1;
 118   5                keyboard->key_status = Key_Lift;
 119   5                keyboard->key_Action_Flag = true;
 120   5              }
 121   4              else if(key == keyboard->key_value[1])  /* ç¬¬äºŒä¸ªæŒ‰é”®æ²¡æ¾æ‰‹ */
 122   4              {
 123   5                keyboard->key_value[0] = 0x00;
 124   5                keyboard->key_Number = 1;
 125   5                keyboard->key_status = Key_Lift;
 126   5                keyboard->key_Action_Flag = true;
 127   5              }
 128   4              else
 129   4              {
 130   5                return;
 131   5              }
 132   4            }
 133   3          }
 134   2        }
 135   1        else if (KeyIsUp(key))
 136   1        {
 137   2          /* æŒ‰é”®æŠ¬èµ· */
 138   2          keyboard->key_Last_value = key;
 139   2          keyboard->key_status = Key_Lift;
 140   2          keyboard->key_value[keyboard->key_Number--] = 0x00;
 141   2          keyboard->key_Action_Flag = true;
 142   2        }
 143   1        else
 144   1        {
 145   2          /* none */
 146   2          keyboard->key_Action_Flag = false;
 147   2          keyboard->key_value[0] = 0x00;
 148   2          keyboard->key_value[1] = 0x00;
 149   2          keyboard->key_status = Key_None;
 150   2          keyboard->key_Last_value = 0x00;
 151   2        }
 152   1      }
 153          
 154          void keyFuncProcess(Key_Info_t *key)
 155          {
 156   1        if (key->key_Action_Flag == false)
 157   1          return;
 158   1        if (key->key_status == Key_Short_Press)
 159   1        {
 160   2          KeyShortAction(key);
 161   2        }
 162   1        else if (key->key_status == Key_Long_Press)
 163   1        {
 164   2          if ((systicks - key->key_long_scan_Count) > 1000)
 165   2          {
 166   3            key->key_long_press_action_flag = true;
 167   3          }
 168   2          if (key->key_long_press_action_flag == true) /* é•¿æŒ‰ä¸æ¾æ‰‹,æ¯2sæ‰§è¡Œä¸€æ¬¡ç¨‹åº */
 169   2          {
 170   3            KeyLongAction(key);
 171   3            key->key_long_press_action_flag = false;
 172   3            key->key_long_scan_Count = systicks;
 173   3          }
 174   2        }
 175   1        else if (key->key_status == Key_Lift)
 176   1        {
C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 4   

 177   2          KeyLiftAction(key);
 178   2        }
 179   1        else if (key->key_status == Key_Compound_Press)
 180   1        {
 181   2          KeyCompoundAction(key);
 182   2        }
 183   1      }
 184          
 185          void KeyShortAction(Key_Info_t *key)
 186          {
 187   1        if (key->key_status != Key_Short_Press)
 188   1          return;
 189   1        switch (key->key_value[0])
 190   1        {
 191   2        case S1:
 192   2          sendString("S1 is down\r\n");
 193   2          break;
 194   2        case S2:
 195   2          sendString("S2 is down\r\n");
 196   2          break;
 197   2        case S3:
 198   2          sendString("S3 is down\r\n");
 199   2          break;
 200   2        case S4:
 201   2          sendString("S4 is down\r\n");
 202   2          break;
 203   2        case S5:
 204   2          sendString("S5 is down\r\n");
 205   2          break;
 206   2        case S6:
 207   2          sendString("S6 is down\r\n");
 208   2          break;
 209   2        case S7:
 210   2          sendString("S7 is down\r\n");
 211   2          break;
 212   2        case S8:
 213   2          sendString("S8 is down\r\n");
 214   2          break;
 215   2        case S9:
 216   2          sendString("S9 is down\r\n");
 217   2          break;
 218   2        case S10:
 219   2          sendString("S10 is down\r\n");
 220   2          break;
 221   2        case S11:
 222   2          sendString("S11 is down\r\n");
 223   2          break;
 224   2        case S12:
 225   2          sendString("S12 is down\r\n");
 226   2          break;
 227   2        case S13:
 228   2          sendString("S13 is down\r\n");
 229   2          break;
 230   2        case S14:
 231   2          sendString("S14 is down\r\n");
 232   2          break;
 233   2        case S15:
 234   2          sendString("S15 is down\r\n");
 235   2          break;
 236   2        case S16:
 237   2          sendString("S16 is down\r\n");
 238   2          break;
C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 5   

 239   2        }
 240   1        key->key_status = Key_None;
 241   1      }
 242          
 243          void KeyLongAction(Key_Info_t *key)
 244          {
 245   1        if (key->key_status != Key_Long_Press)
 246   1          return;
 247   1        switch (key->key_value[0])
 248   1        {
 249   2        case S1:
 250   2          sendString("S1 is LongPress\r\n");
 251   2          break;
 252   2        case S2:
 253   2          sendString("S2 is LongPress\r\n");
 254   2          break;
 255   2        case S3:
 256   2          sendString("S3 is LongPress\r\n");
 257   2          break;
 258   2        case S4:
 259   2          sendString("S4 is LongPress\r\n");
 260   2          break;
 261   2        case S5:
 262   2          sendString("S5 is LongPress\r\n");
 263   2          break;
 264   2        case S6:
 265   2          sendString("S6 is LongPress\r\n");
 266   2          break;
 267   2        case S7:
 268   2          sendString("S7 is LongPress\r\n");
 269   2          break;
 270   2        case S8:
 271   2          sendString("S8 is LongPress\r\n");
 272   2          break;
 273   2        case S9:
 274   2          sendString("S9 is LongPress\r\n");
 275   2          break;
 276   2        case S10:
 277   2          sendString("S10 is LongPress\r\n");
 278   2          break;
 279   2        case S11:
 280   2          sendString("S11 is LongPress\r\n");
 281   2          break;
 282   2        case S12:
 283   2          sendString("S12 is LongPress\r\n");
 284   2          break;
 285   2        case S13:
 286   2          sendString("S13 is LongPress\r\n");
 287   2          break;
 288   2        case S14:
 289   2          sendString("S14 is LongPress\r\n");
 290   2          break;
 291   2        case S15:
 292   2          sendString("S15 is LongPress\r\n");
 293   2          break;
 294   2        case S16:
 295   2          sendString("S16 is LongPress\r\n");
 296   2          break;
 297   2        }
 298   1        key->key_status = Key_None;
 299   1      }
 300          
C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 6   

 301          void KeyLiftAction(Key_Info_t *key)
 302          {
 303   1        uint8_t keyvalue = 0x00;
 304   1        if (key->key_status != Key_Lift)
 305   1          return;
 306   1        if (key->key_value[1] == 0x00 && key->key_value[0] != 0x00)
 307   1          keyvalue = key->key_value[0];
 308   1        else if (key->key_value[1] != 0x00)
 309   1          keyvalue = key->key_value[1];
 310   1        switch (keyvalue)
 311   1        {
 312   2        case S1:
 313   2          sendString("S1 is Lift\r\n");
 314   2          break;
 315   2        case S2:
 316   2          sendString("S2 is Lift\r\n");
 317   2          break;
 318   2        case S3:
 319   2          sendString("S3 is Lift\r\n");
 320   2          break;
 321   2        case S4:
 322   2          sendString("S4 is Lift\r\n");
 323   2          break;
 324   2        case S5:
 325   2          sendString("S5 is Lift\r\n");
 326   2          break;
 327   2        case S6:
 328   2          sendString("S6 is Lift\r\n");
 329   2          break;
 330   2        case S7:
 331   2          sendString("S7 is Lift\r\n");
 332   2          break;
 333   2        case S8:
 334   2          sendString("S8 is Lift\r\n");
 335   2          break;
 336   2        case S9:
 337   2          sendString("S9 is Lift\r\n");
 338   2          break;
 339   2        case S10:
 340   2          sendString("S10 is Lift\r\n");
 341   2          break;
 342   2        case S11:
 343   2          sendString("S11 is Lift\r\n");
 344   2          break;
 345   2        case S12:
 346   2          sendString("S12 is Lift\r\n");
 347   2          break;
 348   2        case S13:
 349   2          sendString("S13 is Lift\r\n");
 350   2          break;
 351   2        case S14:
 352   2          sendString("S14 is Lift\r\n");
 353   2          break;
 354   2        case S15:
 355   2          sendString("S15 is Lift\r\n");
 356   2          break;
 357   2        case S16:
 358   2          sendString("S16 is Lift\r\n");
 359   2          break;
 360   2        }
 361   1        key->key_status = Key_None;
 362   1      }
C51 COMPILER V9.57.0.0   KEY                                                               05/19/2023 22:46:43 PAGE 7   

 363          
 364          void KeyCompoundAction(Key_Info_t *key)
 365          {
 366   1        if (key->key_status != Key_Compound_Press)
 367   1          return;
 368   1        if ((key->key_value[0] == S1 && key->key_value[1] == S6) || (key->key_value[1] == S1 && key->key_value[0]
             - == S6))
 369   1        {
 370   2          sendString("S1 And S2 Compound Press\r\n");
 371   2        }
 372   1        
 373   1        key->key_status = Key_None;
 374   1      }
 375          
 376          uint8_t getKeyValue(void)
 377          {
 378   1        uint8_t i = 0;
 379   1        uint8_t keyValue = 0x00;
 380   1        for (i = 0; i < 4; i++)
 381   1        {
 382   2          P1 = key_row[i];
 383   2          if ((P1 & key_row[i]) != key_row[i])
 384   2          {
 385   3            keyValue = P1;
 386   3            goto k1;
 387   3          }
 388   2        }
 389   1      k1:
 390   1        return keyValue;
 391   1      }
 392          
 393          uint8_t getKeyValue2(void)
 394          {
 395   1        char i = 0;
 396   1        uint8_t keyValue = 0x00;
 397   1        for (i = 3; i > -1; i--)
 398   1        {
 399   2          P1 = key_row[i];
 400   2          if ((P1 & key_row[i]) != key_row[i])
 401   2          {
 402   3            keyValue = P1;
 403   3            goto k2;
 404   3          }
 405   2        }
 406   1      k2:
 407   1        return keyValue;
 408   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1564    ----
   CONSTANT SIZE    =    752    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19      18
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
